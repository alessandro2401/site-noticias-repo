name: Buscar Not√≠cias Automaticamente

on:
  # Executa diariamente √†s 11h (hor√°rio de Bras√≠lia = 14h UTC)
  schedule:
    - cron: '0 14 * * *'
  
  # Permite execu√ß√£o manual via interface do GitHub
  workflow_dispatch:

jobs:
  buscar-noticias:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout reposit√≥rio
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Instalar depend√™ncias
        run: |
          python -m pip install --upgrade pip
          pip install openai
      
      - name: Executar script de busca de not√≠cias
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          cd scripts
          python buscar_noticias.py
      
      - name: Verificar se houve mudan√ßas
        id: verify_changes
        run: |
          if git diff --quiet; then
            echo "changes=false" >> $GITHUB_OUTPUT
            echo "Nenhuma not√≠cia nova encontrada"
          else
            echo "changes=true" >> $GITHUB_OUTPUT
            echo "Novas not√≠cias encontradas!"
          fi
      
      - name: Commit e push das altera√ß√µes
        if: steps.verify_changes.outputs.changes == 'true'
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "GitHub Actions Bot"
          git add src/data/noticias.js
          git commit -m "ü§ñ Atualiza√ß√£o autom√°tica de not√≠cias - $(date +'%d/%m/%Y %H:%M')"
          git push
      
      - name: Notificar conclus√£o
        if: steps.verify_changes.outputs.changes == 'true'
        run: |
          echo "‚úÖ Not√≠cias atualizadas e enviadas para o reposit√≥rio!"
          echo "üöÄ O Vercel far√° o deploy automaticamente"

